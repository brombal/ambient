{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/compare.ts","webpack:///./src/clone.ts","webpack:///./src/browser.ts","webpack:///./src/ambient.ts","webpack:///./src/applyChanges.ts","webpack:///./src/ambient-react.tsx","webpack:///external \"React\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","default","compare","a","b","changed","compared","cloneDeep","clone","constructor","ambient_1","window","Ambient","AmbientSubscriber","withAmbient","compare_1","clone_1","applyChanges_1","ambient_react_1","initialState","this","listeners","currentState","set","nextState","quiet","_this","prevState","forEach","listener","prevMapped","map","nextMapped","action","subscribe","push","unsubscribe","filter","fn","reset","update","updater","awaiter","check","Promise","resolve","state","result","undefined","changer","draft","React","_super","apply","arguments","onUpdate","setState","__extends","componentDidMount","props","store","on","componentWillUnmount","render","children","Component","createElement","ambient","__assign"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","/**\n * Compares a and b for differences.\n * If a and b are identical (===) or equivalent (recursive deep object/array comparison), a is returned.\n * If any properties of a and b are different, `b` is returned. However, all properties of `b` will be compared against\n * `a` using this method.\n */\nexport default function compare(a: any, b: any): any {\n  if (a === b) return a;\n  if (typeof a !== typeof b) return b;\n  if (!b || !a) return b;\n  if (typeof a === 'object') {\n    let changed = false;\n    for (let key in b) {\n      const compared = compare(a[key], b[key]);\n      if (compared !== a[key]) {\n        b[key] = compared;\n        changed = true;\n      } else {\n        b[key] = a[key];\n      }\n    }\n    for (let key in a) {\n      if (!(key in b)) changed = true;\n    }\n    return changed ? b : a;\n  } else {\n    return b;\n  }\n};\n","\nexport default function cloneDeep<T>(value: T): T {\n  let clone = value;\n  if (clone && typeof value === 'object') {\n    clone = (value.constructor === [].constructor ? [] : {}) as T;\n    for (const key in value) {\n      clone[key] = cloneDeep(value[key]);\n    }\n  }\n  return clone;\n};\n","import Ambient, { AmbientSubscriber, withAmbient } from './ambient';\n\ndeclare global {\n  interface Window {\n    Ambient: any;\n  }\n}\n\nwindow.Ambient = Ambient;\nwindow.Ambient.AmbientSubscriber = AmbientSubscriber;\nwindow.Ambient.withAmbient = withAmbient;\n","import compare from './compare';\nimport clone from './clone';\nimport applyChanges from './applyChanges';\nexport { AmbientSubscriber, withAmbient } from './ambient-react';\n\nexport type AmbientStateMapper<T> = (state: T) => any;\ntype AmbientStateAction<T> = (state: T, prevState: T) => void;\n\nexport default class Ambient<State> {\n  currentState: State;\n  listeners: { map: AmbientStateMapper<State>, action: AmbientStateAction<State> }[] = [];\n\n  constructor(private initialState: State = {} as any) {\n    this.currentState = initialState;\n  }\n\n  get(): State {\n    return clone(this.currentState);\n  }\n\n  private set(nextState, quiet) {\n    const prevState = this.currentState;\n    this.currentState = nextState;\n    if (!quiet) {\n      this.listeners.forEach(listener => {\n        const prevMapped = listener.map ? listener.map(prevState) : prevState;\n        const nextMapped = listener.map ? listener.map(nextState) : nextState;\n        if (compare(prevMapped, nextMapped) !== prevMapped)\n          listener.action(this.currentState, prevState);\n      });\n    }\n  }\n\n  subscribe(action: AmbientStateAction<State>, map: AmbientStateMapper<State> = null): void {\n    this.listeners.push({ map, action });\n  }\n\n  unsubscribe(action: AmbientStateAction<State>): void {\n    this.listeners = this.listeners.filter(fn => fn.action !== action);\n  }\n\n  reset(): void {\n    this.currentState = this.initialState;\n  }\n\n  update(updater: AmbientStateAction<State>, quiet: boolean = false): void {\n    const nextState = applyChanges(this.currentState, updater as ((any) => any));\n    if (nextState !== this.currentState) this.set(nextState, quiet);\n  }\n\n  /**\n   * Returns a Promise that resolves when `check` returns anything other than undefined. `check` is called any time the\n   * state updates and changes according to `map`.\n   * @param check The method to call when the state updates. If it returns any value other than undefined, the Promise will resolve.\n   * @param map The method that determines if the state has updated. See Ambient#subscribe().\n   */\n  awaiter(check: AmbientStateMapper<State>, map?: AmbientStateMapper<State>): Promise<void> {\n    return new Promise(resolve => {\n      this.subscribe(state => {\n        const result = check(state);\n        if (result !== undefined)\n          resolve(result);\n      }, map);\n    });\n  }\n};\n","import clone from './clone';\nimport compare from './compare';\n\n/**\n * Calls `changer`, passing in a draft copy of `object`.\n * If `changer` returns a value other than undefined, it is returned.\n * If `changer` mutates the draft copy, any changes made are applied back to `object`\n * selectively so that equivalent values remain \"identical\", but changed values do not.\n */\nexport default function applyChanges<T>(object: T, changer: (T) => any): T {\n  const draft = clone(object);\n  const result = changer(draft);\n  return result ? result : compare(object, draft);\n};\n","import * as React from 'react';\nimport Ambient, { AmbientStateMapper } from \"./ambient\";\n\ninterface AmbientSubscribeProps<State> {\n  store: Ambient<State>;\n  on?: AmbientStateMapper<State>;\n  children?: (state: State) => React.ReactNode;\n}\n\nexport class AmbientSubscriber<State> extends React.Component<AmbientSubscribeProps<State>> {\n  componentDidMount() {\n    this.props.store.subscribe(this.onUpdate, this.props.on);\n  }\n\n  componentWillUnmount() {\n    this.props.store.unsubscribe(this.onUpdate);\n  }\n\n  onUpdate = () => {\n    this.setState({});\n  };\n\n  render() {\n    return this.props.children(this.props.store.get());\n  }\n}\n\nexport const withAmbient = (store, on) => (Component) => (props) => {\n  return (\n    <AmbientSubscriber store={store} on={on}>\n      {ambient => (\n        <Component {...props} ambient={ambient} />\n      )}\n    </AmbientSubscriber>\n  );\n};\n","module.exports = React;"],"sourceRoot":""}