{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/ambient.ts","webpack:///./src/compare.ts","webpack:///./src/clone.ts","webpack:///./src/browser.ts","webpack:///./src/applyChanges.ts","webpack:///./src/ambient-react.tsx","webpack:///external \"React\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","compare_1","clone_1","applyChanges_1","default","state","Ambient","initialState","this","listeners","currentState","set","nextState","quiet","_this","prevState","forEach","listener","prevMapped","map","nextMapped","action","on","push","off","filter","fn","reset","update","updater","awaiter","check","Promise","resolve","result","undefined","compare","a","b","changed","compared","cloneDeep","clone","constructor","ambient_1","window","createAmbient","changer","draft","React","ambient","_super","AmbientSubscriber","apply","arguments","onUpdate","setState","__extends","componentDidMount","props","to","componentWillUnmount","render","children","Component","connect","createElement","react","__assign"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","import compare from './compare';\nimport clone from './clone';\nimport applyChanges from './applyChanges';\n\nexport type AmbientStateMapper<T> = (state: T) => any;\ntype AmbientStateAction<T> = (state: T, prevState: T) => void;\n\nexport interface IAmbient<State> {\n  get(): State;\n  on(map: AmbientStateMapper<State>, action: AmbientStateAction<State>): void;\n  off(action: AmbientStateAction<State>): void;\n  reset(): void;\n  update(updater: AmbientStateAction<State>, quiet?: boolean): void;\n  awaiter(map: AmbientStateMapper<State>, check: AmbientStateMapper<State>): Promise<void>;\n}\n\nexport default function createAmbient<State>(state: State = {} as any): IAmbient<State> {\n  return (new Ambient<State>(state) as any) as IAmbient<State>;\n}\n\nexport class Ambient<State> {\n  currentState: State;\n  listeners: { map: AmbientStateMapper<State>, action: AmbientStateAction<State> }[] = [];\n\n  constructor(private initialState: State = {} as any) {\n    this.currentState = initialState;\n  }\n\n  get(): State {\n    return clone(this.currentState);\n  }\n\n  private set(nextState, quiet) {\n    const prevState = this.currentState;\n    this.currentState = nextState;\n    if (!quiet) {\n      this.listeners.forEach(listener => {\n        const prevMapped = listener.map ? listener.map(prevState) : prevState;\n        const nextMapped = listener.map ? listener.map(nextState) : nextState;\n        if (compare(prevMapped, nextMapped) !== prevMapped)\n          listener.action(this.currentState, prevState);\n      });\n    }\n  }\n\n  on(map: AmbientStateMapper<State>, action: AmbientStateAction<State>): void {\n    this.listeners.push({ map, action });\n  }\n\n  off(action: AmbientStateAction<State>): void {\n    this.listeners = this.listeners.filter(fn => fn.action !== action);\n  }\n\n  reset(): void {\n    this.currentState = this.initialState;\n  }\n\n  update(updater: AmbientStateAction<State>, quiet: boolean = false): void {\n    const nextState = applyChanges(this.currentState, updater as ((any) => any));\n    if (nextState !== this.currentState) this.set(nextState, quiet);\n  }\n\n  /**\n   * Returns a Promise that resolves when `check` returns anything other than undefined. `check` is called any time the\n   * state updates and changes according to `map`.\n   * @param map The method that determines if the state has updated. See Ambient#on().\n   * @param check The method to call when the state updates. If it returns any value other than undefined, the Promise will resolve.\n   */\n  awaiter(map: AmbientStateMapper<State>, check: AmbientStateMapper<State>): Promise<void> {\n    return new Promise(resolve => {\n      this.on(state => {\n        const result = check(state);\n        if (result !== undefined)\n          resolve(result);\n      }, map);\n    });\n  }\n};\n","/**\n * Compares a and b for differences.\n * If a and b are identical (===) or equivalent (recursive deep object/array comparison), a is returned.\n * If any properties of a and b are different, `b` is returned. However, all properties of `b` will be compared against\n * `a` using this method.\n */\nexport default function compare(a: any, b: any): any {\n  if (a === b) return a;\n  if (typeof a !== typeof b) return b;\n  if (!b || !a) return b;\n  if (typeof a === 'object') {\n    let changed = false;\n    for (let key in b) {\n      const compared = compare(a[key], b[key]);\n      if (compared !== a[key]) {\n        b[key] = compared;\n        changed = true;\n      } else {\n        b[key] = a[key];\n      }\n    }\n    for (let key in a) {\n      if (!(key in b)) changed = true;\n    }\n    return changed ? b : a;\n  } else {\n    return b;\n  }\n};\n","\nexport default function cloneDeep<T>(value: T): T {\n  let clone = value;\n  if (clone && typeof value === 'object') {\n    clone = (value.constructor === [].constructor ? [] : {}) as T;\n    for (const key in value) {\n      clone[key] = cloneDeep(value[key]);\n    }\n  }\n  return clone;\n};\n","import createAmbient from './ambient';\nimport './react';\n\ndeclare global {\n  interface Window {\n    createAmbient: any;\n  }\n}\n\nwindow.createAmbient = createAmbient;\n","import clone from './clone';\nimport compare from './compare';\n\n/**\n * Calls `changer`, passing in a draft copy of `object`.\n * If `changer` returns a value other than undefined, it is returned.\n * If `changer` mutates the draft copy, any changes made are applied back to `object`\n * selectively so that equivalent values remain \"identical\", but changed values do not.\n */\nexport default function applyChanges<T>(object: T, changer: (T) => any): T {\n  const draft = clone(object);\n  const result = changer(draft);\n  return result ? result : compare(object, draft);\n};\n","import * as React from 'react';\nimport { IAmbient, AmbientStateMapper, Ambient } from \"./ambient\";\n\ninterface AmbientSubscribeProps<State> {\n  to?: AmbientStateMapper<State>;\n  children?: (state: State) => React.ReactNode;\n}\n\n\n\ndeclare module \"./ambient\" {\n  interface IAmbient<State> {\n    react: any;\n    connect: any;\n  }\n}\n\nObject.defineProperty(Ambient.prototype, 'react', {\n  get: function () {\n    const ambient = this;\n    return class AmbientSubscriber<State> extends React.Component<AmbientSubscribeProps<State>> {\n      componentDidMount() {\n        ambient.on(this.props.to, this.onUpdate);\n      }\n\n      componentWillUnmount() {\n        ambient.off(this.onUpdate);\n      }\n\n      onUpdate = () => {\n        this.setState({});\n      };\n\n      render() {\n        return this.props.children(ambient.get());\n      }\n    };\n  }\n});\n\n\n(Ambient.prototype as any).connect = function(on) {\n  const ambient = this;\n  return (Component) => (props) => {\n    return (\n      <ambient.react to={on}>\n        {state => (\n          <Component {...props} ambient={state} />\n        )}\n      </ambient.react>\n    );\n  };\n};\n","module.exports = React;"],"sourceRoot":""}